<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>trimeshloader: Tutorial 2: Low Level Loading</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">trimeshloader
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Flexible ANSI C trimeshloader 3DS/OBJ</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 2: Low Level Loading </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This tutorial shows how to use the low level loading functions to load from an archive. It is based on the first tutorial. Nearly all OpenGL and application code is stripped. Only some lines are left for orientation.</p>
<h2>Data structure</h2>
<p>We also need the PhysicsFS header:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="trimeshloader_8h.html">trimeshloader.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;physfs.h&quot;</span></div><div class="line"></div><div class="line"><a class="code" href="structtlTrimesh.html">tlTrimesh</a> *gTrimesh = NULL;</div></div><!-- fragment --><h2>Parse</h2>
<p>Load the file provided by the user with PhysicsFS. The API for OBJ and 3DS files is the same, just the names differ. The rough steps are:</p>
<ul>
<li>create a state (3ds or Obj)</li>
<li>pass the data loaded from the file to parser</li>
<li>set the last flag when we reach the end of the file.</li>
<li>create a high level <a class="el" href="structtlTrimesh.html" title="Structure describing an Trimesh (index triangle list) containing objects, vertices (point...">tlTrimesh</a> from the state.</li>
<li>cleanup</li>
</ul>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> load( <span class="keyword">const</span> <span class="keywordtype">char</span> *filename )</div><div class="line">{</div><div class="line">    PHYSFS_file* myfile = PHYSFS_openRead( filename ); </div><div class="line">    <span class="keywordflow">if</span>( myfile )</div><div class="line">    {</div><div class="line">        <span class="keywordtype">char</span> buffer[1024];</div><div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = 0;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>( <a class="code" href="group__low__level__obj__api.html#ga687b590a7a5cda972af0205c79d4df05">tlObjCheckFileExtension</a>( filename ) )</div><div class="line">        {</div><div class="line">            <a class="code" href="group__low__level__obj__api.html#gacdd3ef584c3942f90b1c3be0fe89b7f6">tlObjState</a> *state = <a class="code" href="group__low__level__obj__api.html#ga9cfd15082c5150e6f0315cf337186683">tlObjCreateState</a>();</div><div class="line">            <span class="keywordflow">while</span>( PHYSFS_eof( myfile ) == 0 )</div><div class="line">            {</div><div class="line">                size = (<span class="keywordtype">unsigned</span> int) PHYSFS_read( myfile, buffer, 1, <span class="keyword">sizeof</span>(buffer) );</div><div class="line">                <a class="code" href="group__low__level__obj__api.html#ga2a115bdd8fce78c7f536d919335bf44e">tlObjParse</a>( state, buffer, size, size &lt; <span class="keyword">sizeof</span>(buffer) ? 1 : 0 );</div><div class="line">            }</div><div class="line">            gTrimesh = <a class="code" href="group__high__level__api.html#gad2416c6c1778da05beffedf469c14adc">tlCreateTrimeshFromObjState</a>( state );</div><div class="line">            <a class="code" href="group__low__level__obj__api.html#ga8b0ed78d34ca9d03c4981db0ac23870a">tlObjDestroyState</a>( state );</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="group__low__level__3ds__api.html#ga65fda30cee45242b6c0ea2f782464da7">tl3dsCheckFileExtension</a>( filename ) )</div><div class="line">        {</div><div class="line">            <a class="code" href="group__low__level__3ds__api.html#gaae26f087430a798f857c8791c0928ed7">tl3dsState</a> *state = <a class="code" href="group__low__level__3ds__api.html#gad9041d7b29b9b585eb10b988443a1484">tl3dsCreateState</a>();</div><div class="line">            <span class="keywordflow">while</span>( PHYSFS_eof( myfile ) == 0 )</div><div class="line">            {</div><div class="line">                size = (<span class="keywordtype">unsigned</span> int) PHYSFS_read( myfile, buffer, 1, <span class="keyword">sizeof</span>(buffer) );</div><div class="line">                <a class="code" href="group__low__level__3ds__api.html#gadfdaab3504c2f3e8f6b175ceb4478826">tl3dsParse</a>( state, buffer, size, size &lt; <span class="keyword">sizeof</span>(buffer) ? 1 : 0 );</div><div class="line">            }</div><div class="line">            gTrimesh = <a class="code" href="group__high__level__api.html#ga16cc251bee02c695c954f53206bb52a5">tlCreateTrimeshFrom3dsState</a>( state );</div><div class="line">            <a class="code" href="group__low__level__3ds__api.html#ga75de85923289c025c1b555ffe0ace461">tl3dsDestroyState</a>( state );</div><div class="line">        }</div><div class="line"></div><div class="line">        PHYSFS_close( myfile );   </div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>( gTrimesh == 0 )</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><h2>Init/Destroy</h2>
<p>Iniitalise PhysicsFS and load the trimesh.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div><div class="line">{</div><div class="line">    PHYSFS_init(argv[0]);</div><div class="line">    PHYSFS_AddToSearchPath(<span class="stringliteral">&quot;myzip.zip&quot;</span>, 1);</div><div class="line"></div><div class="line">    <span class="comment">/* other code, setup opengl */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>( load() != 0 )</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">    <span class="comment">/* other code */</span></div><div class="line"></div><div class="line">    <span class="keywordflow">while</span>( running == 1 )</div><div class="line">    {</div><div class="line">        <span class="comment">/* other code */</span></div><div class="line">        draw();</div><div class="line">        <span class="comment">/* other code */</span></div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="group__high__level__api.html#gaa31107359ee6e33dc8a5f74a3daeebb5">tlDeleteTrimesh</a>( gTrimesh );</div><div class="line">    PHYSFS_deinit();</div><div class="line"></div><div class="line">    <span class="comment">/* other code */</span></div><div class="line">}</div></div><!-- fragment --><h2>Data access</h2>
<p>The draw functions stays the same:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> draw()</div><div class="line">{</div><div class="line">    glPushMatrix();</div><div class="line">    glRotatef( -90.0f, 1.0f, 0.0f, 0.0f );</div><div class="line">    glColor3f( 0.0f, 0.0f, 1.0f );</div><div class="line">    glEnableClientState( GL_VERTEX_ARRAY );</div><div class="line">    glVertexPointer( 3, GL_FLOAT, <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * 8, gTrimesh-&gt;<a class="code" href="structtlTrimesh.html#a531986acfdaf4741337d65debdfe3e00">vertices</a> );</div><div class="line">    <span class="keywordflow">for</span>( i = 0; i &lt; gTrimesh-&gt;<a class="code" href="structtlTrimesh.html#a8229b2b63dd984192b13b312c1e34f89">object_count</a>; i++)</div><div class="line">    {</div><div class="line">        glDrawElements( GL_TRIANGLES, gTrimesh-&gt;<a class="code" href="structtlTrimesh.html#a507511d2e8785cd1b80ed14ccb0582e3">objects</a>[i].<a class="code" href="structtlObject.html#a300fd3a43bbf51db75a52f79df9191ce">face_count</a>  * 3, GL_UNSIGNED_SHORT, &amp;gTrimesh-&gt;<a class="code" href="structtlTrimesh.html#a37fd9b488446919ceb0bdda53d02272a">faces</a>[gTrimesh-&gt;<a class="code" href="structtlTrimesh.html#a507511d2e8785cd1b80ed14ccb0582e3">objects</a>[i].<a class="code" href="structtlObject.html#a2eb313e1a098ab8e7b75d255c54c0e07">face_index</a>] );</div><div class="line">    }</div><div class="line">    glDisableClientState( GL_VERTEX_ARRAY );</div><div class="line">    glPopMatrix();</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
